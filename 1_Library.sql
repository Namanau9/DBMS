CREATE TABLE PUBLISHER 
(
    NAME VARCHAR(20) PRIMARY KEY,
    PHONE INTEGER,
    ADDRESS VARCHAR(20)
);

CREATE TABLE BOOK 
(
    BOOK_ID INTEGER PRIMARY KEY,
    TITLE VARCHAR(20),
    PUB_YEAR VARCHAR(20),
    PUBLISHER_NAME VARCHAR(20),
    FOREIGN KEY (PUBLISHER_NAME) REFERENCES PUBLISHER(NAME) ON DELETE CASCADE
);

CREATE TABLE BOOK_AUTHORS 
(
    AUTHOR_NAME VARCHAR(20),
    BOOK_ID INTEGER,
    FOREIGN KEY (BOOK_ID) REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE,
    PRIMARY KEY (BOOK_ID, AUTHOR_NAME)
);

CREATE TABLE LIBRARY_BRANCH 
(
    BRANCH_ID INTEGER PRIMARY KEY,
    BRANCH_NAME VARCHAR(50),
    ADDRESS VARCHAR(50)
);

CREATE TABLE BOOK_COPIES 
(
    NO_OF_COPIES INTEGER,
    BOOK_ID INTEGER,
    BRANCH_ID INTEGER,
    FOREIGN KEY (BOOK_ID) REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE,
    FOREIGN KEY (BRANCH_ID) REFERENCES LIBRARY_BRANCH(BRANCH_ID) ON DELETE CASCADE,
    PRIMARY KEY (BOOK_ID, BRANCH_ID)
);

CREATE TABLE CARD 
(
    CARD_NO INTEGER PRIMARY KEY
);

CREATE TABLE BOOK_LENDING 
(
    DATE_OUT DATE,
    DUE_DATE DATE,
    BOOK_ID INTEGER,
    BRANCH_ID INTEGER,
    CARD_NO INTEGER,
    FOREIGN KEY (BOOK_ID) REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE,
    FOREIGN KEY (BRANCH_ID) REFERENCES LIBRARY_BRANCH(BRANCH_ID) ON DELETE CASCADE,
    FOREIGN KEY (CARD_NO) REFERENCES CARD(CARD_NO) ON DELETE CASCADE,
    PRIMARY KEY (BOOK_ID, BRANCH_ID, CARD_NO)
);


INSERT INTO publishers  VALUES ('MCGRAW-HILL', '9989076587', 'BANGALORE');
INSERT INTO publishers  VALUES ('PEARSON', '9889076565', 'KOLKATTA');
INSERT INTO publishers  VALUES ('SPRINGER', '9989076544', 'PUNE');
INSERT INTO publishers  VALUES ('PENGUIN', '9889056565', 'GUJARATH');
INSERT INTO publishers  VALUES ('TATA', '9889073560', 'GOA');



INSERT INTO BOOK  VALUES (1, 'DBMS', 'JAN-2017', 'MCGRAW-HILL');
INSERT INTO BOOK  VALUES (2, 'JAVA', 'JUNE-2017', 'MCGRAW-HILL');
INSERT INTO BOOK  VALUES (4, 'PYTHON', 'JAN-2017', 'PENGUIN');
INSERT INTO BOOK  VALUES (5, 'ADBMS', 'JAN-2017', 'TATA');
INSERT INTO BOOK  VALUES (3, 'SE', 'JAN-2017', 'PEARSON');


INSERT INTO BOOK_AUTHORS  VALUES ('NAVATHE', 1);
INSERT INTO BOOK_AUTHORS  VALUES ('GALVIN', 2);
INSERT INTO BOOK_AUTHORS  VALUES ('SOMERVILLE', 3);
INSERT INTO BOOK_AUTHORS  VALUES ('IVAN', 4);
INSERT INTO BOOK_AUTHORS  VALUES ('BALGURU', 5);



INSERT INTO LIBRARY_BRANCH  VALUES (10, 'RR NAGAR', 'BANGALORE');
INSERT INTO LIBRARY_BRANCH  VALUES (11, 'NITTE', 'BANGALORE');
INSERT INTO LIBRARY_BRANCH  VALUES (12, 'MIT', 'MANIPAL');
INSERT INTO LIBRARY_BRANCH  VALUES (13, 'MUDBIDRI', 'MANGALORE');
INSERT INTO LIBRARY_BRANCH  VALUES (14, 'SMVT', 'UDUPI');


INSERT INTO BOOK_COPIES  VALUES (10, 1, 10);
INSERT INTO BOOK_COPIES  VALUES (5, 1, 11);
INSERT INTO BOOK_COPIES  VALUES (11, 2, 12);
INSERT INTO BOOK_COPIES  VALUES (6, 3, 13);


INSERT INTO CARD  VALUES (101);
INSERT INTO CARD  VALUES (102);
INSERT INTO CARD  VALUES (103);
INSERT INTO CARD  VALUES (104);
INSERT INTO CARD  VALUES (105);



INSERT INTO BOOK_LENDING (DATE_OUT, DUE_DATE, BOOK_ID, BRANCH_ID, CARD_NO) 
VALUES ('01-JAN-20', '01-JUN-20', 1, 10, 101);

INSERT INTO BOOK_LENDING (DATE_OUT, DUE_DATE, BOOK_ID, BRANCH_ID, CARD_NO) 
VALUES ('01-FEB-20', '01-JUN-20', 1, 11, 101);

INSERT INTO BOOK_LENDING (DATE_OUT, DUE_DATE, BOOK_ID, BRANCH_ID, CARD_NO) 
VALUES ('01-JAN-20', '06-DEC-20', 2, 12, 102);

INSERT INTO BOOK_LENDING (DATE_OUT, DUE_DATE, BOOK_ID, BRANCH_ID, CARD_NO) 
VALUES ('01-JAN-20', '01-JUN-20', 1, 13, 101);

INSERT INTO BOOK_LENDING (DATE_OUT, DUE_DATE, BOOK_ID, BRANCH_ID, CARD_NO) 
VALUES ('01-APR-20', '01-JUN-20', 3, 10, 103);


--1.RETRIEVE DETAILS OF ALL BOOKS IN THE LIBRARY – ID, TITLE, NAME OF PUBLISHER, AUTHORS, NUMBER OF COPIES IN EACH BRANCH, ETC.

	SELECT B.BOOK_ID, B.TITLE, B.PUBLISHER_NAME, A.AUTHOR_NAME, C.NO_OF_COPIES, L.BRANCH_ID  
	FROM BOOK B, BOOK_AUTHORS A, BOOK_COPIES C, LIBRARY_BRANCH L  
	WHERE B.BOOK_ID=A.BOOK_ID  
	AND B.BOOK_ID=C.BOOK_ID  
	AND L.BRANCH_ID=C.BRANCH_ID;

--2.GET THE PARTICULARS OF BORROWERS WHO HAVE BORROWED MORE THAN 2 BOOKS, IN THE YEAR 2020

	SELECT CARD_NO FROM BOOK_LENDING  
	WHERE DATE_OUT BETWEEN '01-JAN-2020' AND '01-DEC-2020'  
	GROUP BY CARD_NO  
	HAVING COUNT (*)>2;

--3.DELETE A BOOK IN BOOK TABLE. UPDATE THE CONTENTS OF OTHER TABLES TO REFLECT THIS DATA MANIPULATION OPERATION.

	DELETE FROM BOOK WHERE BOOK_ID=3;
	– UPDATE OTHER TABLES
	DELETE FROM BOOK_AUTHORS WHERE BOOK_ID = 3;  
	DELETE FROM BOOK_COPIES WHERE BOOK_ID = 3;

--4.DISPLAY THE TOTAL NUMBER OF BOOKS PUBLISHED BY EACH PUBLISHER

	SELECT PUBLISHER_NAME, COUNT(*) AS TOTAL_BOOKS  
	FROM BOOK  
	GROUP BY PUBLISHER_NAME;

--5.CREATE A VIEW OF ALL BOOKS AND THEIR NUMBER OF COPIES THAT ARE CURRENTLY AVAILABLE IN THE LIBRARY:

	CREATE VIEW V_BOOKS AS  
	SELECT B.BOOK_ID, B.TITLE, C.NO_OF_COPIES  
	FROM BOOK B, BOOK_COPIES C, LIBRARY_BRANCH L  
	WHERE B.BOOK_ID=C.BOOK_ID  
	AND C.BRANCH_ID=L.BRANCH_ID;
